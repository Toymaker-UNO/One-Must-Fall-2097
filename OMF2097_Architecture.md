# One Must Fall 2097 (OpenOMF) 소스코드 아키텍처

## 📋 프로젝트 개요

One Must Fall 2097은 1994년에 출시된 2D 격투 게임의 오픈소스 리메이크 프로젝트입니다. C 언어로 작성되어 있으며, SDL2를 기반으로 크로스 플랫폼을 지원합니다.

## 🏗️ 전체 아키텍처

```
One Must Fall 2097 (OpenOMF)
├── 🎮 핵심 엔진
│   ├── main.c          # 프로그램 진입점
│   └── engine.c/h      # 게임 엔진 핵심
├── 🎯 게임 로직 (game/)
│   ├── game_state      # 게임 상태 관리
│   ├── objects         # 게임 오브젝트 시스템
│   ├── scenes          # 게임 씬들 (메뉴, 아레나 등)
│   ├── gui             # 사용자 인터페이스
│   └── utils           # 게임 유틸리티
├── 🎵 오디오 (audio/)
│   ├── audio.c/h       # 오디오 시스템
│   ├── backends        # 오디오 백엔드들
│   └── sources         # 음악 소스들
├── 🖼️ 비디오 (video/)
│   ├── video.c/h       # 렌더링 시스템
│   ├── renderers       # 다양한 렌더러들
│   └── vga_*           # VGA 관련 기능들
├── 🎮 입력 (controller/)
│   ├── controller.c/h  # 컨트롤러 시스템
│   ├── keyboard        # 키보드 입력
│   ├── joystick        # 조이스틱 입력
│   └── ai_controller   # AI 컨트롤러
├── 📁 파일 포맷 (formats/)
│   ├── af.c/h          # 로봇 데이터 (AF)
│   ├── bk.c/h          # 배경 데이터 (BK)
│   ├── chr.c/h         # 캐릭터 스프라이트
│   └── 기타 포맷들...
└── 🛠️ 유틸리티 (utils/)
    ├── allocator       # 메모리 관리
    ├── log             # 로깅 시스템
    └── 기타 유틸리티들...
```

## 🎮 핵심 엔진 모듈

### main.c
- **역할**: 프로그램 진입점, 명령행 인수 처리, 초기화
- **주요 기능**:
  - SDL2, ENet 네트워킹 초기화
  - 설정 파일 로드
  - 게임 컨트롤러 스캔
  - 엔진 초기화 및 실행

### engine.c/h
- **역할**: 게임 엔진의 핵심 로직과 게임 루프 관리
- **주요 기능**:
  - 비디오, 오디오, 폰트, 언어 시스템 초기화
  - 게임 루프 (이벤트 처리, 렌더링, 틱 처리)
  - 스크린샷, 팔레트 저장 기능
  - 디버그 기능 (F키 단축키)

## 🎯 게임 로직 모듈 (game/)

### 게임 상태 시스템
- **`game_state_type.h`**: 게임 상태의 핵심 데이터 구조 정의
  - `match_settings`: 게임 매치 설정 (던지기 범위, 히트 일시정지, 블록 데미지 등)
  - `game_state`: 게임의 전체 상태 (플레이어, 오브젝트, 씬, 네트워크 모드 등)

### 오브젝트 시스템
- **`object.h`**: 게임 내 모든 오브젝트의 기본 구조
  - 위치, 속도, 애니메이션, 충돌, 렌더링 등 모든 게임 오브젝트의 공통 속성
  - 콜백 함수들 (tick, move, collide, render 등)
  - 그룹 분류 (HAR, SCRAP, PROJECTILE, HAZARD 등)

### 씬 시스템
- **`scene.h`**: 게임의 각 화면/상황을 관리
  - 메인 메뉴, 아레나, 메크랩, 로비 등 다양한 씬들
  - 각 씬별 이벤트 처리, 렌더링, 틱 처리

### 게임 씬들 (scenes/)
- **메인 메뉴**: `mainmenu/` - 다양한 설정 메뉴들
- **메크랩**: `mechlab/` - 로봇 커스터마이징
- **아레나**: `arena.c` - 실제 전투 씬
- **로비**: `lobby.c` - 네트워크 게임 로비
- **기타**: 인트로, 크레딧, 뉴스룸 등

## 🎵 오디오 시스템 (audio/)

### 핵심 API
- **`audio.h`**: 오디오 시스템의 핵심 API
  - 다양한 백엔드 지원 (SDL, null)
  - 사운드 재생 (볼륨, 팬닝, 피치 조절)
  - 음악 재생 및 페이드 아웃
  - Opus, PSM 음악 포맷 지원

### 백엔드
- **SDL 백엔드**: SDL2 기반 오디오 출력
- **Null 백엔드**: 오디오 없는 모드

### 음악 소스
- **Opus**: 고품질 압축 오디오 포맷
- **PSM**: 원본 게임의 음악 포맷

## 🖼️ 비디오 시스템 (video/)

### 핵심 API
- **`video.h`**: 렌더링 시스템의 핵심 API
  - 네이티브 해상도: 320x200 (VGA)
  - 스프라이트 렌더링 (리맵핑, 팔레트 오프셋, 스케일링)
  - 아틀라스 기반 최적화된 렌더링
  - 스크린샷 기능

### 렌더러들
- 다양한 하드웨어 가속 렌더러 지원
- VGA 팔레트 기반 그래픽 시스템

## 🎮 입력 시스템 (controller/)

### 핵심 API
- **`controller.h`**: 입력 시스템의 핵심
  - 다양한 컨트롤러 타입 (키보드, 게임패드, AI, 네트워크, 녹화)
  - 액션 정의 (STOP, KICK, PUNCH, 방향키 등)
  - 이벤트 시스템과 훅 지원
  - 지연 처리 및 리와인드 기능

### 컨트롤러 타입
- **키보드**: 키보드 입력 처리
- **조이스틱**: 게임패드/조이스틱 입력
- **AI**: 인공지능 컨트롤러
- **네트워크**: 멀티플레이어용 네트워크 컨트롤러
- **녹화**: 게임 플레이 녹화/재생

## 📁 파일 포맷 시스템 (formats/)

### 주요 포맷들
- **AF (Fighter)**: 로봇/캐릭터 데이터
- **BK (Background)**: 배경/씬 데이터
- **CHR**: 캐릭터 스프라이트
- **PCX**: 이미지 포맷
- **PIC**: 그림 데이터
- **PAL**: 팔레트 데이터
- **REC**: 녹화 파일
- **기타**: 폰트, 사운드, 스크립트 등

## 🛠️ 유틸리티 모듈 (utils/)

### 메모리 관리
- **`allocator.c/h`**: 커스텀 메모리 할당자
- **`array.c/h`**: 동적 배열
- **`vector.c/h`**: 벡터 자료구조

### 로깅 시스템
- **`log.c/h`**: 로깅 시스템
- **`msgbox.c/h`**: 메시지 박스

### 기타 유틸리티
- **`str.c/h`**: 문자열 유틸리티
- **`config.c/h`**: 설정 관리
- **`random.c/h`**: 난수 생성

## 🔧 주요 특징

1. **모듈화된 설계**: 각 기능별로 명확히 분리된 모듈 구조
2. **VGA 기반**: 320x200 네이티브 해상도, 팔레트 기반 그래픽
3. **네트워크 지원**: 멀티플레이어 및 로비 시스템
4. **다양한 입력**: 키보드, 조이스틱, AI, 네트워크 컨트롤러
5. **녹화/재생**: 게임 플레이 녹화 및 재생 기능
6. **크로스 플랫폼**: SDL2 기반으로 다양한 플랫폼 지원

## 🎮 게임의 핵심 시스템

### 오브젝트 시스템
- 모든 게임 요소의 기본 구조
- 위치, 속도, 애니메이션, 충돌, 렌더링 관리
- 콜백 기반 이벤트 처리

### 씬 시스템
- 메뉴, 아레나, 메크랩 등 각 화면 관리
- 씬별 이벤트 처리, 렌더링, 틱 처리

### 애니메이션 시스템
- 스프라이트 기반 애니메이션
- 팔레트 기반 색상 처리

### 물리 시스템
- 중력, 충돌, 이동 처리
- 2D 격투 게임에 특화된 물리

### 네트워크 시스템
- 멀티플레이어 지원
- 롤백 네트워킹 (rollback networking)

## 📚 빌드 및 의존성

### 주요 의존성
- **SDL2**: 크로스 플랫폼 지원
- **ENet**: 네트워킹
- **libepoxy**: OpenGL 바인딩
- **libxmp**: 음악 모듈 지원
- **opusfile**: Opus 오디오 지원

### 빌드 시스템
- **CMake**: 크로스 플랫폼 빌드
- **vcpkg**: 패키지 관리

## 🚀 개발 환경

### 지원 플랫폼
- Windows
- Linux
- macOS
- 기타 SDL2 지원 플랫폼

### 개발 도구
- C 컴파일러 (GCC, Clang, MSVC)
- CMake
- Git

---

*이 문서는 One Must Fall 2097 (OpenOMF) 프로젝트의 소스코드 구조를 분석하여 작성되었습니다.*
